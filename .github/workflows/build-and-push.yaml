name: Build and push artifacts

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write
  pull-requests: write

jobs:
  Artifactory_Login:
    uses: MapColonies/shared-workflows/actions/artifactory-login@artifactory-login-v1.0.0
    with:
      registry: ACR_URL
      username: ACR_PUSH_USER
      password: ACR_PUSH_TOKEN

  Build_Docker_Image:
    uses: MapColonies/shared-workflows/actions/build-docker@build-docker-v1.1.0
    with:
      # for example
      # domain: infra
      domain: YOUR-DOMAIN
      registry: ACR_URL

  Push_Docker_Image:
    uses: MapColonies/shared-workflows/actions/push-docker@push-docker-v1.0.1
    with:
      # for example
      # image_name: scaler
      # image_tag: v1.0.0
      image_name: DOCKER_IMAGE_NAME
      image_tag: DOCKER_IMAGE_TAG


  Build_and_Push_Helm_Chart:
    uses: MapColonies/shared-workflows/actions/build-and-push-helm@build-and-push-helm-v1.0.1
    with:
      # Example
      # context: ./infra/monitoring
      # domain: infra
      context: YOUR-PATH
      domain: YOUR-DOMAIN
      registry: ACR_URL

  update_artifacts_file:
    uses: MapColonies/shared-workflows/actions/update-artifacts-file@update-artifacts-file-v1.1.1
    with:
      # Example:
      # domain: infra
      # artifact_name: sftpgo
      # artifact_tag: v1.2.3
      # type: docker
      domain: YOUR_DOMAIN
      artifact_name: ARTIFACT_NAME
      artifact_tag: ARTIFACT_TAG
      type: ARTIFACT_TYPE
      registry: ACR_URL
      github_token: YOUR_GITHUB_TOKEN

